<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DoubleZero Cap Generator</title>
  <style>
    :root { --accent: #6a00ff; }
    body {
      margin: 0; font-family: Inter, Arial, sans-serif;
      background: #ffffff; color: #111;
      display: flex; flex-direction: column; align-items: center;
      padding: 24px;
    }
    h1 { margin: 8px 0 16px; font-weight: 700; font-size: 24px; }
    #app { display: flex; gap: 24px; align-items: flex-start; }
    .header-logo { max-width: 120px; margin-bottom: 8px; }
    .canvas-wrap {
      width: 600px; height: 600px; border: 1px solid #e6e6e6;
      border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      display: flex; align-items: center; justify-content: center;
      background: #fff;
    }
    canvas { width: 560px; height: 560px; border-radius: 8px; background: #fff; }
    .controls {
      width: 320px; background: rgba(250,250,250,0.9);
      padding: 16px; border-radius: 10px; border: 1px solid #f0f0f0;
    }
    .controls label { display: block; font-size: 13px; margin-top: 10px; color: #333; }
    input[type="range"] { width: 100%; margin-top: 6px; }
    input[type="file"] { margin-top: 8px; }
    .row { display: flex; gap: 8px; align-items: center; margin-top: 12px; }
    button {
      background: var(--accent); color: white; border: none;
      padding: 10px 14px; border-radius: 8px; cursor: pointer; font-weight: 600;
    }
    button.secondary { background: #efefef; color: #333; }
    .small { font-size: 12px; padding: 8px 10px; }
    .site-watermark {
      position: fixed; bottom: 8px; width: 100%; text-align: center;
      font-size: 12px; color: rgba(0,0,0,0.3); pointer-events: none;
    }
  </style>
</head>
<body>
  <img src="doublezero-logo.png" alt="DoubleZero Logo" class="header-logo">
  <h1>DoubleZero Cap Generator</h1>

  <div id="app">
    <div class="canvas-wrap">
      <canvas id="canvas" width="560" height="560"></canvas>
    </div>

    <div class="controls">
      <label>Upload Photo (your image)
        <input type="file" id="uploadPhoto" accept="image/*">
      </label>

      <label>Cap Size (px)
        <input type="range" id="size" min="40" max="500" value="200">
      </label>

      <label>Cap Rotation (degrees)
        <input type="range" id="rotation" min="-180" max="180" value="0">
      </label>

      <!-- Flip Controls -->
      <label>
        <input type="checkbox" id="flipHorizontal"> Flip Cap (Left / Right)
      </label>
      <label>
        <input type="checkbox" id="flipVertical"> Flip Cap (Up / Down)
      </label>

      <!-- Front Cap Option -->
      <label>
        <input type="checkbox" id="capFront"> Show Cap Front
      </label>

      <label>Cap X Position
        <input type="range" id="posX" min="0" max="560" value="280">
      </label>

      <label>Cap Y Position
        <input type="range" id="posY" min="0" max="560" value="120">
      </label>

      <label>Logo Opacity (background watermark)
        <input type="range" id="logoOpacity" min="0" max="50" value="12">
      </label>

      <div class="row">
        <button id="reset" class="small secondary">Reset</button>
        <button id="download" class="small">Download Image</button>
      </div>
    </div>
  </div>

  <div class="site-watermark">bbdim</div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    const uploadEl = document.getElementById('uploadPhoto');
    const sizeEl = document.getElementById('size');
    const rotEl  = document.getElementById('rotation');
    const posXEl = document.getElementById('posX');
    const posYEl = document.getElementById('posY');
    const logoOpacityEl = document.getElementById('logoOpacity');
    const flipHorizontalEl = document.getElementById('flipHorizontal');
    const flipVerticalEl = document.getElementById('flipVertical');
    const capFrontEl = document.getElementById('capFront');
    const downloadBtn = document.getElementById('download');
    const resetBtn = document.getElementById('reset');

    let uploadedImage = null;

    const capFront = new Image();
    const capFlipped = new Image();
    const capFrontImg = new Image();
    capFront.src = "my-cap.png";
    capFlipped.src = "my-cap-flipped.png";
    capFrontImg.src = "my-cap-front.png";

    let capLoaded = false;
    capFront.onload = capFlipped.onload = capFrontImg.onload = () => { capLoaded = true; draw(); };

    const logoImg = new Image();
    let logoLoaded = false;
    logoImg.onload = () => { logoLoaded = true; draw(); };
    logoImg.src = "doublezero-logo.png";

    posXEl.max = canvas.width;
    posYEl.max = canvas.height;

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0,0,canvas.width,canvas.height);

      if (uploadedImage) {
        const img = uploadedImage;
        const cw = canvas.width, ch = canvas.height;
        const r = Math.max(cw / img.width, ch / img.height);
        const w = img.width * r;
        const h = img.height * r;
        const x = (cw - w) / 2;
        const y = (ch - h) / 2;
        ctx.drawImage(img, x, y, w, h);
      }

      if (logoLoaded) {
        ctx.save();
        ctx.globalAlpha = parseFloat(logoOpacityEl.value) / 100;
        const targetW = canvas.width * 0.78;
        const scale = targetW / logoImg.width;
        const targetH = logoImg.height * scale;
        ctx.drawImage(logoImg, (canvas.width-targetW)/2, (canvas.height-targetH)/2, targetW, targetH);
        ctx.restore();
      }

      if (capLoaded) {
        const capSize = parseInt(sizeEl.value, 10);
        const capX = parseInt(posXEl.value, 10);
        const capY = parseInt(posYEl.value, 10);
        const deg = parseInt(rotEl.value, 10);
        const rad = deg * Math.PI / 180;

        const aspect = capFront.height / capFront.width;
        const drawW = capSize;
        const drawH = Math.round(capSize * aspect);

        ctx.save();
        ctx.translate(capX, capY);
        ctx.rotate(rad);

        let capToDraw;
        if (capFrontEl.checked) {
          capToDraw = capFrontImg; // front cap image
        } else {
          capToDraw = flipHorizontalEl.checked ? capFlipped : capFront;
        }

        const scaleY = flipVerticalEl.checked ? -1 : 1;
        ctx.scale(1, scaleY);

        ctx.drawImage(capToDraw, -drawW/2, -drawH/2, drawW, drawH);
        ctx.restore();
      }
    }

    uploadEl.addEventListener('change', (ev) => {
      const f = ev.target.files && ev.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        uploadedImage = new Image();
        uploadedImage.onload = draw;
        uploadedImage.src = e.target.result;
      };
      reader.readAsDataURL(f);
    });

    [sizeEl, rotEl, posXEl, posYEl, logoOpacityEl, flipHorizontalEl, flipVerticalEl].forEach(el => {
      el.addEventListener('input', draw);
      el.addEventListener('change', draw);
    });

    capFrontEl.addEventListener('change', () => {
      if (capFrontEl.checked) {
        flipHorizontalEl.checked = false;
        flipVerticalEl.checked = false;
        flipHorizontalEl.disabled = true;
        flipVerticalEl.disabled = true;

        rotEl.value = 0;
        rotEl.disabled = true;
      } else {
        flipHorizontalEl.disabled = false;
        flipVerticalEl.disabled = false;
        rotEl.disabled = false;
      }
      draw();
    });

    resetBtn.addEventListener('click', () => {
      sizeEl.value = 200;
      rotEl.value = 0;
      posXEl.value = Math.round(canvas.width / 2);
      posYEl.value = 120;
      logoOpacityEl.value = 12;
      flipHorizontalEl.checked = false;
      flipVerticalEl.checked = false;
      capFrontEl.checked = false;
      flipHorizontalEl.disabled = false;
      flipVerticalEl.disabled = false;
      rotEl.disabled = false;
      draw();
    });

    downloadBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'capped-image.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });

    posXEl.value = Math.round(canvas.width / 2);
    posYEl.value = 120;
    draw();
  </script>
</body>
</html>
